{"version":3,"sources":["src/tetris.js"],"names":[],"mappings":"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","file":"tetris.js","sourcesContent":["import Tetromino from 'javascripts/tetromino';\nimport TetrisMap from 'javascripts/tetrismap';\nimport Controller from 'javascripts/controller';\nimport Sound from 'javascripts/sound';\n\nexport default class Tetris {\n\n    constructor(options) {\n        this.options = options;\n\n        this._initInterface();\n        this._startGame();\n    }\n\n    _initInterface() {\n        const gameArea = document.getElementById(this.options.gameArea);\n\n        this.canvas = document.createElement('canvas');\n        this.canvas.innerText = 'Your browser doesn\\'t support html5 canvas, please upgrade your browser.';\n        gameArea.appendChild(this.canvas);\n        this.ctx = this.canvas.getContext('2d');\n\n        this.gameConfig = {};\n        this.gameConfig.rows = 20;\n        this.gameConfig.columns = 10;\n        let tetrominoSize = 0;\n        if (document.body.clientWidth <= 767) {\n            // phone\n            tetrominoSize = 2 * Math.floor(document.body.clientWidth * 0.85 / (this.gameConfig.columns + 6));\n        } else if (document.body.clientWidth <= 959) {\n            // pad\n            tetrominoSize = 56;\n        } else {\n            // desktop\n            tetrominoSize = 64;\n        }\n\n        this.gameConfig.tetrominoSize = tetrominoSize;\n        this.gameConfig.mapWidth = tetrominoSize * this.gameConfig.columns;\n        this.gameConfig.mapHeight = tetrominoSize * this.gameConfig.rows;\n        this.gameConfig.gap = tetrominoSize;\n        this.gameConfig.infoWidth = tetrominoSize * 4;\n\n        this.canvas.width = this.gameConfig.mapWidth + this.gameConfig.gap + this.gameConfig.infoWidth + this.gameConfig.gap;\n        this.canvas.height = this.gameConfig.mapHeight;\n        this.canvas.style.width = this.canvas.width / 2 + 'px';\n        this.canvas.style.height = this.canvas.height / 2 + 'px';\n\n        // controlArea for controller\n        Controller.controlArea = {\n            top: 197,\n            left: (window.innerWidth - this.canvas.width / 2) / 2,\n            right: (window.innerWidth + this.canvas.width / 2) / 2,\n            bottom: 197 + this.canvas.height / 2\n        };\n\n        // first start screen\n        this._gameEnd(false);\n\n        // load sound\n        this.soundGlint = new Sound('sounds/glint.wav');\n        this.soundLand = new Sound('sounds/land.wav');\n        this.soundMove = new Sound('sounds/move.wav');\n        this.soundTrans = new Sound('sounds/trans.wav');\n\n        // safari won't auto load sound unless user clicked\n        // there is a trick that play sound 1ms while user touches canvas first time\n        if (navigator.userAgent.match(/(iPad|iPhone)/)) {\n            this.canvas.setAttribute('ontouchstart', `\n            window.soundMove.loadForSafari();\n            window.soundGlint.loadForSafari();\n            window.soundLand.loadForSafari();\n            window.soundTrans.loadForSafari();\n            delete window.soundMove;\n            delete window.soundGlint;\n            delete window.soundLand;\n            delete window.soundTrans;\n            this.removeAttribute(\"ontouchstart\");`.replace(/            /g, '').split('\\n').join(''));\n\n            window.soundMove = this.soundMove;\n            window.soundGlint = this.soundGlint;\n            window.soundLand = this.soundLand;\n            window.soundTrans = this.soundTrans;\n        }\n    }\n\n    _resetGameData() {\n        const tetrominoSize = this.gameConfig.tetrominoSize;\n        const ctx = this.ctx;\n        // clear canvas\n        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n        this.map = new TetrisMap(this.gameConfig, ctx);\n        this.map.drawBackground();\n        this.map.draw();\n\n        this._drawLeftText('black', 'NEXT', tetrominoSize, 0, tetrominoSize * 2);\n        this._drawLeftText('black', 'SPEED', tetrominoSize, 0, tetrominoSize * 11);\n        this._drawLeftText('black', 'SCORE', tetrominoSize, 0, tetrominoSize * 15);\n\n        // get a random tetromino\n        this.tetromino = new Tetromino(this.gameConfig, this.ctx);\n        this.nextTetromino = new Tetromino(this.gameConfig, this.ctx);\n\n        // draw next tetromino\n        this._drawNextTetromino();\n        // draw speed\n        this.count = 1;\n        this.speed = 50;\n        this._drawLeftText('black', this.speed, tetrominoSize, 1, tetrominoSize * 13);\n        // draw score\n        this.score = 0;\n        this._drawLeftText('black', this.score, tetrominoSize, 1, tetrominoSize * 17);\n\n        localStorage.TetrisUnfinishedGame = true;\n    }\n\n    _recoverGameData() {\n        const tetrominoSize = this.gameConfig.tetrominoSize;\n        const ctx = this.ctx;\n        // clear canvas\n        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\n        this.map = new TetrisMap(this.gameConfig, ctx);\n        this.map.load('TetrisMap');\n        this.map.drawBackground();\n        this.map.draw();\n\n        this._drawLeftText('black', 'NEXT', tetrominoSize, 0, tetrominoSize * 2);\n        this._drawLeftText('black', 'SPEED', tetrominoSize, 0, tetrominoSize * 11);\n        this._drawLeftText('black', 'SCORE', tetrominoSize, 0, tetrominoSize * 15);\n\n        // get a random tetromino\n        this.tetromino = new Tetromino(this.gameConfig, this.ctx);\n        this.tetromino.load('TetrisTetromino');\n        this.nextTetromino = new Tetromino(this.gameConfig, this.ctx);\n        this.nextTetromino.load('TetrisNextTetromino');\n\n        // draw next tetromino\n        this._drawNextTetromino();\n        // draw speed\n        this.count = parseInt(localStorage.TetrisCount);\n        this.speed = parseInt(localStorage.TetrisSpeed);\n        this._drawLeftText('black', this.speed, tetrominoSize, 1, tetrominoSize * 13);\n        // draw score\n        this.score = parseInt(localStorage.TetrisScore);\n        this._drawLeftText('black', this.score, tetrominoSize, 1, tetrominoSize * 17);\n\n        localStorage.TetrisUnfinishedGame = true;\n    }\n\n    _startGame() {\n        Controller.addListener(this.canvas, (direction)=> {\n            if (this.staticScreen) {\n                // if has saved game data\n                if (localStorage.TetrisUnfinishedGame !== undefined) {\n                    if (confirm('An unfinished game detected, do you want to continue what you left?')) {\n                        this._recoverGameData();\n                    } else {\n                        this._resetGameData();\n                    }\n                } else {\n                    this._resetGameData();\n                }\n\n                this._saveData();\n                this.staticScreen = false;\n                // start auto down\n                setTimeout(autoDown, 900 - this.speed);\n            } else {\n                switch (direction) {\n                    case 'left':\n                        this.soundMove.replay();\n                        if (this.map.canTetrominoMove(this.tetromino, -1, 0)) {\n                            this.tetromino.move(-1, 0);\n                            this.map.updateTetrominoFixedPosition(this.tetromino);\n                        }\n                        break;\n                    case 'right':\n                        this.soundMove.replay();\n                        if (this.map.canTetrominoMove(this.tetromino, 1, 0)) {\n                            this.tetromino.move(1, 0);\n                            this.map.updateTetrominoFixedPosition(this.tetromino);\n                        }\n                        break;\n                    case 'down':\n                        this.soundMove.replay();\n                        if (this.map.canTetrominoMove(this.tetromino, 0, 1)) {\n                            this.tetromino.move(0, 1);\n                        }\n                        break;\n                    case 'up':\n                        this.soundTrans.replay();\n                        if (this.map.canTetrominoTransform(this.tetromino)) {\n                            this.tetromino.setShape(this.tetromino.getNextShape());\n                            this.map.updateTetrominoFixedPosition(this.tetromino);\n                        }\n                        break;\n                }\n            }\n\n            // draw\n            this.map.drawBackground();\n            this.map.draw();\n            this.map.drawTetrominoFixedPosition(this.tetromino);\n            this.tetromino.draw();\n        });\n\n        // tetromino auto down\n        const autoDown = ()=> {\n            if (!this.map.canTetrominoMove(this.tetromino, 0, 1)) {\n                // reach bottom\n                this.soundLand.replay();\n                this.map.setTetrominoToMap(this.tetromino, this.soundGlint, ()=> {\n                    // calc & update score\n                    this.score += this.map.getScore();\n                    this._drawLeftText('black', this.score, this.gameConfig.tetrominoSize, 1, this.gameConfig.tetrominoSize * 17);\n                    // create a new tetromino\n                    this.tetromino = this.nextTetromino;\n                    this.nextTetromino = new Tetromino(this.gameConfig, this.ctx);\n                    this.count++;\n                    // draw next tetromino\n                    this._drawNextTetromino();\n                    // calc & update speed\n                    if (this.count % 20 === 0 && this.speed < 750) {\n                        this.speed += 50;\n                        this._drawLeftText('black', this.speed, this.gameConfig.tetrominoSize, 1, this.gameConfig.tetrominoSize * 13);\n                    }\n\n                    // save data\n                    this._saveData();\n\n                    // next turn\n                    if (this.map.canTetrominoMove(this.tetromino, 0, 1)) {\n                        autoDown();\n                    } else {\n                        this._gameEnd(true);\n                    }\n                });\n            } else {\n                // down one block\n                this.tetromino.move(0, 1);\n                // next turn\n                setTimeout(autoDown, 900 - this.speed);\n            }\n\n            // draw\n            if (!this.staticScreen) {\n                this.map.drawBackground();\n                this.map.draw();\n                this.map.drawTetrominoFixedPosition(this.tetromino);\n                this.tetromino.draw();\n            }\n        };\n    }\n\n    _saveData() {\n        localStorage.TetrisCount = this.count;\n        localStorage.TetrisSpeed = this.speed;\n        localStorage.TetrisScore = this.score;\n        this.map.save('TetrisMap');\n        this.tetromino.save('TetrisTetromino');\n        this.nextTetromino.save('TetrisNextTetromino');\n    }\n\n    _drawNextTetromino() {\n        const ctx = this.ctx;\n        const config = this.gameConfig;\n        const size = config.tetrominoSize;\n\n        // clean area\n        ctx.clearRect(config.columns * size + config.gap, size * 4, size * 4, size * 4);\n\n        // draw next tetromino\n        this.nextTetromino.draw(config.columns + config.gap / size + 2, 5 + 1);\n\n        // draw current tetromino fixed position\n        this.map.updateTetrominoFixedPosition(this.tetromino);\n    }\n\n    _gameEnd(isOver) {\n        if (isOver) {\n            localStorage.removeItem('TetrisUnfinishedGame');\n        }\n\n        this.staticScreen = true;\n\n        const ctx = this.ctx;\n        const config = this.gameConfig;\n        const size = config.tetrominoSize;\n\n        const drawMapCenterText = (text, color, strokeColor, fontSize, yPercent)=> {\n            ctx.fillStyle = color;\n            ctx.strokeStyle = strokeColor;\n            ctx.font = `bold ${fontSize}px Arial`;\n            ctx.textBaseline = 'top';\n            const ms = ctx.measureText(text);\n            ctx.fillText(text, (config.mapWidth - ms.width) / 2, config.mapHeight * yPercent);\n            ctx.strokeText(text, (config.mapWidth - ms.width) / 2, config.mapHeight * yPercent);\n        };\n\n        // draw mask\n        ctx.fillStyle = 'rgba(115, 115, 115, .8)';\n        ctx.fillRect(0, 0, config.mapWidth, config.mapHeight);\n\n        // draw title\n        const title = isOver ? 'Game Over' : 'Welcome';\n        drawMapCenterText(title, 'green', 'white', size * 1.4, .35);\n        // draw tips\n        const status = isOver ? 'restart' : 'start';\n        drawMapCenterText('press any key to ' + status, 'white', 'transparent', size * .6, .5);\n    }\n\n    _drawLeftText(color, text, size, offsetX, y) {\n        const ctx = this.ctx;\n        const config = this.gameConfig;\n\n        ctx.fillStyle = color;\n        ctx.font = `bold ${size}px Arial`;\n        ctx.textBaseline = 'top';\n        // swipe original text\n        ctx.clearRect(config.mapWidth + config.gap + offsetX * config.tetrominoSize, y, config.tetrominoSize * text.toString().length, config.tetrominoSize);\n        // draw new text\n        ctx.fillText(text, config.mapWidth + config.gap + offsetX * config.tetrominoSize, y);\n    };\n\n    set options(_options) {\n        const options = {\n            gameArea: ''\n        };\n\n        for (let key in options) {\n            if (_options[key] !== undefined) {\n                options[key] = _options[key];\n            }\n        }\n\n        this._options = options;\n    }\n\n    get options() {\n        return this._options;\n    }\n}"]}